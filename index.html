<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Mahjong Tenpai Training Game - Improve your mahjong skills by identifying waiting tiles in various hands.">
    <title>聴牌でGO!</title>
    <meta name="theme-color" content="#0b1f15">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap">
    <link id="google-fonts-jp" rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap" media="print" onload="this.media='all'">
    <noscript>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap">
    </noscript>

    <style>
        /* Inlined utilities.css to reduce render-blocking request chain. */
        /* Minimal utility classes to replace Tailwind CDN for this project.
           Keep this block small and only add what the HTML uses. */

        /* Layout */
        .hidden { display: none !important; }
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .grid { display: grid; }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-9 { grid-template-columns: repeat(9, minmax(0, 1fr)); }
        .relative { position: relative; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .mt-auto { margin-top: auto; }

        /* Sizing */
        .max-w-3xl { max-width: 48rem; }
        .max-w-4xl { max-width: 56rem; }

        /* Spacing (Tailwind-compatible values) */
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mb-12 { margin-bottom: 3rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }

        /* Typography */
        .text-center { text-align: center; }
        .whitespace-pre-line { white-space: pre-line; }
        .font-bold { font-weight: 700; }
        .font-black { font-weight: 900; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .text-5xl { font-size: 3rem; line-height: 1; }
        .text-6xl { font-size: 3.75rem; line-height: 1; }
        .text-7xl { font-size: 4.5rem; line-height: 1; }
        .text-white { color: #ffffff; }
        .text-purple-300 { color: #d9b26f; }
        .text-purple-200 { color: #f2d08a; }
        .text-green-300 { color: #86efac; }
        .text-red-300 { color: #fca5a5; }
        .text-yellow-300 { color: #fde047; }
        .opacity-80 { opacity: 0.8; }
        .opacity-90 { opacity: 0.9; }

        /* Transitions */
        .transition-all {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        .duration-700 { transition-duration: 700ms; }

        /* Borders (minimal) */
        .border-t-0 { border-top-width: 0; }
        .border-purple-600 { border-color: #7a4a28; }

        /* Animations (approx Tailwind) */
        @keyframes util-bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .animate-bounce { animation: util-bounce 1s infinite; }
        @keyframes util-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse { animation: util-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>

    <link rel="preload" as="style" href="styles.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen text-white transition-all duration-700">
    <div id="scale-stage" class="scale-stage">
    <div id="design-root" class="design-root">
        
        <header class="text-center mb-12 fade-in">
            <h1 id="header-title" class="text-6xl font-black mb-4 text-shadow-glow">聴牌でGO!</h1>
            <p id="header-subtitle" class="text-2xl font-bold text-purple-300">麻雀聴牌トレーニングゲーム</p>
        </header>

        <main id="app-main" class="app-main">

        <div id="preload-screen" class="screen-container fade-in">
            <h2 id="preload-title" class="text-4xl font-bold mb-6 text-center">Loading…</h2>
            <p id="preload-subtitle" class="text-xl opacity-80 text-center mb-8">Preloading assets for smoother play</p>
            <div class="preload-progress-wrap max-w-3xl mx-auto">
                <div class="preload-progress-bar">
                    <div id="preload-progress-fill" class="preload-progress-fill" style="width:0%"></div>
                </div>
                <div id="preload-progress-text" class="text-center mt-4 text-lg opacity-90">0%</div>
            </div>
        </div>

        <div id="language-screen" class="screen-container fade-in hidden">
            <h2 id="language-title" class="text-4xl font-bold mb-8 text-center">言語を選択 / Select Language / 選擇語言</h2>
            <div class="grid grid-cols-3 gap-6 max-w-4xl mx-auto">
                <button id="lang-ja" class="mode-btn">
                    <div class="text-5xl mb-4">🇯🇵</div>
                    <div id="lang-ja-text" class="text-2xl font-bold">日本語</div>
                </button>
                <button id="lang-en" class="mode-btn">
                    <div class="text-5xl mb-4">🇬🇧</div>
                    <div id="lang-en-text" class="text-2xl font-bold">English</div>
                </button>
                <button id="lang-zh" class="mode-btn">
                    <div class="text-5xl mb-4">🇭🇰</div>
                    <div id="lang-zh-text" class="text-2xl font-bold">繁體中文</div>
                </button>
            </div>
        </div>

        <div id="mode-screen" class="screen-container hidden">
            <button id="mode-back-btn" class="nav-back-btn" type="button" aria-label="Back">
                <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M20 11H7.83l5.58-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                <span id="mode-back-text">Back</span>
            </button>
            <div class="flex items-center justify-center relative mb-8">
                <h2 id="mode-title" class="text-4xl font-bold text-center">Select Game Mode</h2>
                <button id="tutorial-btn" class="tutorial-btn" type="button" aria-label="Tutorial">
                    <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path fill="currentColor" d="M18 2H6a2 2 0 0 0-2 2v15a3 3 0 0 1 3-3h13v-2H7a1 1 0 0 0-1 1V4h12v13h2V4a2 2 0 0 0-2-2z"/>
                    </svg>
                    <span id="tutorial-btn-text" class="tutorial-btn-text">Tutorial</span>
                </button>
            </div>
            <div class="grid grid-cols-3 gap-6 max-w-4xl mx-auto">
                <button id="casual-btn" class="mode-btn">
                    <div class="text-5xl mb-4">CASUAL</div>
                    <div id="casual-title" class="text-2xl font-bold mb-3">Casual Mode</div>
                    <div id="casual-desc" class="text-sm opacity-80 whitespace-pre-line">9 Questions + BOSS Stage</div>
                </button>
                <button id="story-btn" class="mode-btn">
                    <div class="text-5xl mb-4">STORY</div>
                    <div id="story-title" class="text-2xl font-bold mb-3">Story Mode</div>
                    <div id="story-desc" class="text-sm opacity-80 whitespace-pre-line">Progressive Difficulty</div>
                </button>
                <button id="survival-btn" class="mode-btn">
                    <div class="text-5xl mb-4">SURVIVAL</div>
                    <div id="survival-title" class="text-2xl font-bold mb-3">Survival Mode</div>
                    <div id="survival-desc" class="text-sm opacity-80 whitespace-pre-line">Infinite Questions</div>
                </button>
            </div>
        </div>

        <div id="tutorial-screen" class="tutorial-overlay hidden" aria-hidden="true">
            <div class="tutorial-modal" role="dialog" aria-modal="true" aria-labelledby="tutorial-title">
                <div class="tutorial-modal-header">
                    <div class="tutorial-modal-title-wrap">
                        <h2 id="tutorial-title" class="tutorial-modal-title">Tutorial</h2>
                        <div id="tutorial-page-indicator" class="tutorial-page-indicator">1/5</div>
                    </div>

                    <div class="tutorial-modal-actions">
                        <button id="tutorial-prev-btn" class="mode-btn action-btn tutorial-nav-btn" type="button">
                            <span id="tutorial-prev-text">Prev</span>
                        </button>
                        <button id="tutorial-next-btn" class="mode-btn action-btn tutorial-nav-btn" type="button">
                            <span id="tutorial-next-text">Next</span>
                        </button>
                        <button id="tutorial-close-btn" class="mode-btn tutorial-close-btn" type="button">
                            <span id="tutorial-close-text">Close</span>
                        </button>
                    </div>
                </div>

                <div class="tutorial-modal-body">
                    <div class="tutorial-section">
                        <h3 id="tutorial-page-title" class="text-3xl font-black mb-4 text-purple-200 text-center">Title</h3>
                        <div id="tutorial-page-body" class="tutorial-body text-xl text-center"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="difficulty-screen" class="screen-container hidden">
            <button id="difficulty-back-btn" class="nav-back-btn" type="button" aria-label="Back">
                <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                    <path fill="currentColor" d="M20 11H7.83l5.58-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                <span id="difficulty-back-text">Back</span>
            </button>
            <h2 id="difficulty-title" class="text-4xl font-bold mb-8 text-center">Select Difficulty</h2>
            <div class="grid grid-cols-3 gap-6 max-w-4xl mx-auto">
                <button id="easy" class="mode-btn">
                    <div class="text-5xl mb-4">EASY</div>
                    <div id="easy-title" class="text-2xl font-bold mb-3">Easy</div>
                    <div id="easy-desc" class="text-sm opacity-80">Up to 3 waits</div>
                </button>
                <button id="medium" class="mode-btn">
                    <div class="text-5xl mb-4">MEDIUM</div>
                    <div id="medium-title" class="text-2xl font-bold mb-3">Medium</div>
                    <div id="medium-desc" class="text-sm opacity-80">Up to 6 waits</div>
                </button>
                <button id="hard" class="mode-btn">
                    <div class="text-5xl mb-4">HARD</div>
                    <div id="hard-title" class="text-2xl font-bold mb-3">Hard</div>
                    <div id="hard-desc" class="text-sm opacity-80">Up to 9 waits</div>
                </button>
            </div>
        </div>

        <div id="game-screen" class="screen-container hidden">
            <div id="boss-indicator" class="boss-title text-center hidden">
                <div class="text-6xl font-black animate-pulse">BOSS STAGE</div>
            </div>

            <div id="stage-intro" class="stage-intro hidden" aria-hidden="true">
                <div class="stage-intro-card">
                    <div id="stage-intro-title" class="stage-intro-title"></div>
                    <div id="stage-intro-subtitle" class="stage-intro-subtitle"></div>
                </div>
            </div>

            <div class="hud-top">
                <div class="hud-left">
                    <h3 id="question-number" class="font-bold">Question 1/9</h3>
                    <p id="stage-info" class="text-purple-300"></p>
                    <p id="time-bonus-display" class="mt-1 hidden"></p>
                    <p id="lives-display" class="mt-1 hidden"></p>
                </div>

                <div class="hud-center">
                    <div id="timer-display" class="timer-value">30</div>
                    <div class="timer-bar-container">
                        <div id="timer-bar" class="timer-bar"></div>
                    </div>
                </div>

                <div class="hud-right">
                    <div id="time-extension-slot" class="time-extension-slot"></div>
                </div>
            </div>

            <div class="game-main">
                <div class="mb-6">
                    <h4 id="hand-title" class="text-2xl font-bold text-center mb-3">Your Hand</h4>
                    <div id="hand-tiles" class="flex flex-wrap gap-2 justify-center"></div>
                </div>

                <div class="mb-6 wait-section">
                    <h4 id="select-waiting-title" class="text-2xl font-bold text-center mb-3">Select All Waiting Tiles</h4>
                    <div id="possible-tiles" class="grid grid-cols-9 gap-4 max-w-3xl mx-auto"></div>
                </div>
            </div>

            <div class="action-bar">
                <button id="submit-btn" class="mode-btn action-btn">
                    <span id="submit-text">Check Answer</span>
                </button>
            </div>

            <!-- 結果モーダル（16:9 フレーム内でスクロール） -->
            <div id="result-section" class="hidden">
                <div class="result-container">
                    <div id="result-message" class="text-3xl font-bold text-green-300 mb-6">Correct!</div>
                    <div id="correct-answer-display" class="mb-6"></div>

                    <div id="result-nav" class="mt-6 flex gap-6 justify-center flex-wrap">
                        <button id="next-btn" class="mode-btn action-btn hidden">
                            <span id="next-text">Next Question</span>
                        </button>
                    </div>

                    <div id="result-actions" class="mt-6 hidden">
                        <div id="result-actions-title" class="text-3xl font-black mb-3 text-center"></div>
                        <div id="result-actions-body" class="text-xl mb-6 text-center"></div>
                        <div class="flex gap-6 justify-center flex-wrap">
                            <button id="result-ok-btn" class="mode-btn action-btn hidden">
                                <span id="result-ok-text">OK</span>
                            </button>
                            <button id="result-continue-btn" class="mode-btn continue-btn hidden">
                                <span id="result-continue-text">Continue</span>
                            </button>
                            <button id="result-back-btn" class="mode-btn hidden">
                                <span id="result-back-text">Back to Menu</span>
                            </button>
                        </div>
                    </div>

                    <div id="hand-breakdown" class="mb-6"></div>
                </div>
            </div>
        </div>

        <div id="victory-screen" class="victory-screen hidden">
            <div class="victory-content">
                <h2 id="victory-title" class="text-7xl font-black mb-8 animate-bounce">VICTORY!</h2>
                <div class="text-3xl mb-8">
                    <p class="mb-4"><span id="mode-label">Mode:</span> <span id="mode" class="font-bold text-purple-300"></span></p>
                    <p class="mb-4"><span id="final-difficulty-label">Difficulty:</span> <span id="final-difficulty" class="font-bold"></span></p>
                    <p class="mb-4"><span id="final-time-left-label">Time Left:</span> <span id="final-time-left" class="font-bold text-purple-200">0</span></p>
                    <p class="mb-4"><span id="final-lives-left-label">Lives Left:</span> <span id="final-lives-left" class="font-bold"></span></p>
                </div>
                <div class="flex gap-6 justify-center flex-wrap">
                    <button id="play-again-victory" class="reset-btn mode-btn">Play Again</button>
                    <button id="menu-victory" class="reset-btn mode-btn">Back to Menu</button>
                </div>
                <p class="mt-4 text-sm opacity-80"><span id="score-version-label">Scoring Version:</span> <span id="score-version" class="font-bold text-yellow-200">1.0</span></p>
            </div>
        </div>

        <div id="gameover-screen" class="gameover-screen hidden">
            <div class="gameover-content">
                <h2 id="gameover-title" class="text-7xl font-black mb-8">GAME OVER</h2>
                <div id="gameover-message" class="text-4xl mb-8 text-red-300"></div>
                <div class="text-3xl mb-8">
                    <p class="mb-4"><span id="mode-label-gameover">Mode:</span> <span id="mode-gameover" class="font-bold text-purple-300"></span></p>
                    <p class="mb-4"><span id="final-difficulty-label-gameover">Difficulty:</span> <span id="final-difficulty-gameover" class="font-bold"></span></p>
                    <p class="mb-4"><span id="final-score-label">Correct:</span> <span id="final-score" class="font-bold text-yellow-300">0</span></p>
                </div>
                <div class="flex gap-6 justify-center flex-wrap">
                    <button id="play-again-gameover" class="reset-btn mode-btn">Play Again</button>
                    <button id="menu-gameover" class="reset-btn mode-btn">Back to Menu</button>
                </div>
                <p class="mt-4 text-sm opacity-80"><span id="score-version-label-gameover">Scoring Version:</span> <span id="score-version-gameover" class="font-bold text-yellow-200">1.0</span></p>
            </div>
        </div>

        </main>

        <footer class="text-center py-6 mt-auto border-t-0 border-purple-600">
            <p id="footer-text" class="text-lg font-bold">聴牌でGO! <span id="game-version"></span> &copy; 2025-<span id="current-year"></span> Akira Akiyama</p>
        </footer>
    </div>
    </div>

    <script src="game.js" defer></script>
</body>
</html>